@model TheForgiveness.Models.experienciaModel

@{
    ViewBag.Title = "CreateExperience";
    Layout = "~/Views/Shared/DashBoard.cshtml";
    ViewBag.Style = "../Assets/Css/Subject/create.min.css";
}
<script>
    var municipio = [
        @{
            int j = 0;
            foreach (System.Data.DataRow row in ViewBag.municipio.Rows)
            {
                if (j != 0)
                {
                    @:, {

                         @:id: @row["ID"],
                         @:Municipio: unescape("@row["Municipio"]"),
                         @:Departamento: @row["Departamento"]
                        @:}
                }
                else
                {
                    @:{
                         @:id: @row["ID"],
                         @:Municipio: unescape("@row["Municipio"]"),
                         @:Departamento: @row["Departamento"]
                        @:}
                }
                j++;
            }
         }
    ];
</script>
<h1>Registrar una Experiencia</h1>
<hr />
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.FechaExperiencia, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.FechaExperiencia, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.FechaExperiencia, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Experiencia, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Experiencia, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Experiencia, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="col-sm-5 col-sm-offset-1">
            <div class="form-group">
                <label class="control-label">Departamento</label>
                <select name="Departamento" class="form-control" onchange="cargar(this.value)">
                    <option value="default"></option>
                    @foreach (System.Data.DataRow row in ViewBag.departamento.Rows)
                    {
                        <option value=@row["ID"]>@row["Departamento"]</option>
                    }
                </select>
            </div>
        </div>
        <div class="col-sm-5">
            <div class="form-group">
                <label class="control-label">Municipio</label>
                <select name="Municipio" class="form-control " id="Municipio">
                    <option value="default"></option>
                </select>
            </div>
        </div>
        <hr />
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </div>
    </div>
}
<script>


    function cargar(id) {
        let ele = document.getElementById('Municipio');
        if (ele.length > 1) {
            let limite = ele.length;//defino variable, sino el length se refresca
            for (let i = 0; i < limite; i++) {
                ele.remove(ele.children[i]);
            }
            let option = document.createElement("option");
            ele.add(option);
        }
        for (let i = 0; i < municipio.length; i++) {
            if (municipio[i].Departamento === parseInt(id)) {
                let option = document.createElement("option");
                option.text = municipio[i].Municipio;
                option.value = municipio[i].id;
                ele.add(option);
            }
        }
    }

</script>
<div>
    @Html.ActionLink("Back to List", "Index", "DashBoard")
</div>
